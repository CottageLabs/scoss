!function(n){n.fn.bindWithDelay=function(i,t,u,e,o){function l(){var i=n.extend(!0,{},arguments[0]),t=function(){r=null,u.apply(a,[i])};o||clearTimeout(r),o&&r||(r=setTimeout(t,e))}var r=null,a=this;return n.isFunction(t)&&(o=e,e=u,u=t,t=void 0),this.bind(i,t,l)}}(jQuery);
var edges={newEdge:function(e){return e||(e={}),new edges.Edge(e)},Edge:function(e){this.selector=e.selector||"body",this.search_url=edges.getParam(e.search_url,!1),this.datatype=e.datatype||"jsonp",this.preflightQueries=edges.getParam(e.preflightQueries,!1),this.baseQuery=e.baseQuery||!1,this.openingQuery=e.openingQuery||"undefined"!=typeof es?es.newQuery():!1,this.secondaryQueries=edges.getParam(e.secondaryQueries,!1),this.initialSearch=edges.getParam(e.initialSearch,!0),this.staticFiles=edges.getParam(e.staticFiles,[]),this.manageUrl=e.manageUrl||!1,this.urlQuerySource=e.urlQuerySource||"source",this.template=e.template||!1,this.components=e.components||[],this.renderPacks=e.renderPacks||[edges.bs3,edges.nvd3,edges.highcharts,edges.google,edges.d3],this.urlQuery=!1,this.urlParams={},this.shortUrl=!1,this.currentQuery=!1,this.result=!1,this.preflightResults={},this.realisedSecondaryQueries={},this.secondaryResults={},this.searching=!1,this.context=!1,this["static"]={},this.resources={},this.errorLoadingStatic=[],this.startup=function(){if(this.context=$(this.selector),this.context.trigger("edges:pre-init"),this.manageUrl){var e=this.getUrlParams();this.urlQuerySource in e&&(this.urlQuery=es.newQuery({raw:e[this.urlQuerySource]}),delete e[this.urlQuerySource]),this.urlParams=e}this.template&&this.template.draw(this);for(var t=0;t<this.components.length;t++){var r=this.components[t];r.init(this)}this.draw();var s=edges.objClosure(this,"startupPart2");this.loadStaticsAsync(s)},this.startupPart2=function(){var e=edges.objClosure(this,"startupPart3");this.runPreflightQueries(e)},this.startupPart3=function(){var e=this.openingQuery;this.urlQuery&&(e=this.urlQuery,this.urlQuery=!1);for(var t=0;t<this.components.length;t++){var r=this.components[t];r.contrib(e)}this.pushQuery(e),this.context.trigger("edges:post-init"),this.cycle()},this.doQuery=function(){this.cycle()},this.cycle=function(){if(!this.searching)if(this.searching=!0,this.shortUrl=!1,this.context.trigger("edges:pre-query"),this.manageUrl&&this.updateUrl(),this.search_url){var e=edges.objClosure(this,"cyclePart2");this.doPrimaryQuery(e)}else this.cyclePart2()},this.cyclePart2=function(){var e=edges.objClosure(this,"cyclePart3");this.runSecondaryQueries(e)},this.cyclePart3=function(){this.synchronise(),this.context.trigger("edges:pre-render"),this.draw(),this.context.trigger("edges:post-render"),this.searching=!1},this.synchronise=function(){for(var e=0;e<this.components.length;e++){var t=this.components[e];t.synchronise()}},this.draw=function(){for(var e=0;e<this.components.length;e++){var t=this.components[e];t.draw(this)}},this.reset=function(){this.context.trigger("edges:pre-reset");for(var e=this.cloneOpeningQuery(),t=0;t<this.components.length;t++){var r=this.components[t];r.contrib(e)}this.pushQuery(e),this.context.trigger("edges:post-reset"),this.cycle()},this.cloneQuery=function(){return this.currentQuery?$.extend(!0,{},this.currentQuery):!1},this.pushQuery=function(e){this.baseQuery&&e.merge(this.baseQuery),this.currentQuery=e},this.cloneBaseQuery=function(){return this.baseQuery?$.extend(!0,{},this.baseQuery):es.newQuery()},this.cloneOpeningQuery=function(){return this.openingQuery?$.extend(!0,{},this.openingQuery):es.newQuery()},this.doPrimaryQuery=function(e){var t={callback:e};es.doQuery({search_url:this.search_url,queryobj:this.currentQuery.objectify(),datatype:this.datatype,success:edges.objClosure(this,"querySuccess",["result"],t),error:edges.objClosure(this,"queryFail",t)})},this.queryFail=function(e){var t=e.context;this.context.trigger("edges:query-fail"),t()},this.querySuccess=function(e){this.result=e.result;var t=e.callback;this.context.trigger("edges:query-success"),t()},this.runPreflightQueries=function(e){if(!this.preflightQueries||0==Object.keys(this.preflightQueries).length)return void e();this.context.trigger("edges:pre-preflight");for(var t=[],r=Object.keys(this.preflightQueries),s=0;s<r.length;s++){var i=r[s];t.push({id:i,query:this.preflightQueries[i]})}var n=this,c=edges.newAsyncGroup({list:t,action:function(e){var t=e.entry,r=e.success_callback,s=e.error_callback;es.doQuery({search_url:n.search_url,queryobj:t.query.objectify(),datatype:n.datatype,success:r,error:s})},successCallbackArgs:["result"],success:function(e){var t=e.result,r=e.entry;n.preflightResults[r.id]=t},errorCallbackArgs:["result"],error:function(e){n.context.trigger("edges:error-preflight")},carryOn:function(){n.context.trigger("edges:post-preflight"),e()}});c.process()},this.runSecondaryQueries=function(e){if(this.realisedSecondaryQueries={},!this.secondaryQueries||0==Object.keys(this.secondaryQueries).length)return void e();var t=[];for(var r in this.secondaryQueries){var s={};s.query=this.secondaryQueries[r](this),s.id=r,t.push(s),this.realisedSecondaryQueries[r]=s.query}var i=this,n=edges.newAsyncGroup({list:t,action:function(e){var t=e.entry,r=e.success_callback;e.error_callback;es.doQuery({search_url:i.search_url,queryobj:t.query.objectify(),datatype:i.datatype,success:r,complete:!1})},successCallbackArgs:["result"],success:function(e){var t=e.result,r=e.entry;i.secondaryResults[r.id]=t},errorCallbackArgs:["result"],error:function(e){},carryOn:function(){e()}});n.process()},this.getComponent=function(e){for(var t=e.id,r=0;r<this.components.length;r++){var s=this.components[r];if(s.id===t)return s}return!1},this.category=function(e){for(var t=[],r=0;r<this.components.length;r++){var s=this.components[r];s.category===e&&t.push(s)}return t},this.getRenderPackObject=function(e,t){for(var r=0;r<this.renderPacks.length;r++){var s=this.renderPacks[r];if(s&&s.hasOwnProperty(e))return s[e](t)}},this.jq=function(e){return $(e,this.context)},this.getUrlParams=function(){var e={},t=window.location.href,r=!1;t.indexOf("#")>-1&&(r=t.slice(t.indexOf("#")),t=t.substring(0,t.indexOf("#")));for(var s=t.slice(t.indexOf("?")+1).split("&"),i=0;i<s.length;i++){var n=s[i].split("=");if(2===n.length){var c=decodeURIComponent(n[1]);("["==c[0]||"{"==c[0])&&(c=c.replace(/^"/,"").replace(/"$/,""),c=JSON.parse(c)),e[n[0]]=c}}return r&&(e["#"]=r),e},this.urlQueryArg=function(e){e||(e={include_query_string:!0,include_filters:!0,include_paging:!0,include_sort:!0,include_fields:!1,include_aggregations:!1,include_facets:!1});var t=JSON.stringify(this.currentQuery.objectify(e)),r={};return r[this.urlQuerySource]=encodeURIComponent(t),r},this.fullQueryArgs=function(){var e=$.extend(!0,{},this.urlParams);return $.extend(e,this.urlQueryArg()),e},this.fullUrlQueryString=function(){return this._makeUrlQuery(this.fullQueryArgs())},this._makeUrlQuery=function(e){for(var t=Object.keys(e),r=[],s=0;s<t.length;s++){var i=t[s],n=e[i];r.push(i+"="+n)}return r.join("&")},this.fullUrl=function(){var e=this.fullQueryArgs(),t="";e["#"]&&(t="#"+e["#"],delete e["#"]);var r=window.location.toString(),s=r.split("?"),i=s[0]+"?"+this._makeUrlQuery(e)+t;return i},this.updateUrl=function(){if("pushState"in window.history){var e="?"+this.fullUrlQueryString();window.history.pushState("","",e)}},this.loadStaticsAsync=function(e){if(!this.staticFiles||0==this.staticFiles.length)return this.context.trigger("edges:post-load-static"),void e();var t=this,r=edges.newAsyncGroup({list:this.staticFiles,action:function(e){var t=e.entry,r=e.success_callback,s=e.error_callback,i=(t.id,t.url),n=edges.getParam(t.datatype,"text");$.ajax({type:"get",url:i,dataType:n,success:r,error:s})},successCallbackArgs:["data"],success:function(e){var r=e.data,s=e.entry;if(s.processor){var i=s.processor({data:r});t.resources[s.id]=i,s.opening&&s.opening({resource:i})}t["static"][s.id]=r},errorCallbackArgs:["data"],error:function(e){t.errorLoadingStatic.push(e.entry.id),t.context.trigger("edges:error-load-static")},carryOn:function(){t.context.trigger("edges:post-load-static"),e()}});r.process()},this.startup()},newAsyncGroup:function(e){return e||(e={}),new edges.AsyncGroup(e)},AsyncGroup:function(e){this.list=e.list,this.successCallbackArgs=e.successCallbackArgs,this.errorCallbackArgs=e.errorCallbackArgs;var t=e.action,r=e.success,s=e.carryOn,i=e.error;this.functions={action:t,success:r,carryOn:s,error:i},this.checkList=[],this.finished=!1,this.construct=function(e){for(var t=0;t<this.list.length;t++)this.checkList.push(0)},this.process=function(e){0==this.list.length&&this.functions.carryOn();for(var t=0;t<this.list.length;t++){var r={index:t},s=edges.objClosure(this,"_actionSuccess",this.successCallbackArgs,r),i=edges.objClosure(this,"_actionError",this.successCallbackArgs,r),n=!1;this.functions.action({entry:this.list[t],success_callback:s,error_callback:i,complete_callback:n})}},this._actionSuccess=function(e){var t=e.index;delete e.index,e.entry=this.list[t],this.functions.success(e),this.checkList[t]=1,this._isComplete()&&this._finalise()},this._actionError=function(e){var t=e.index;delete e.index,e.entry=this.list[t],this.functions.error(e),this.checkList[t]=-1,this._isComplete()&&this._finalise()},this._actionComplete=function(e){},this._isComplete=function(){return-1===$.inArray(0,this.checkList)},this._finalise=function(){this.finished||(this.finished=!0,this.functions.carryOn())},this.construct()},newRenderer:function(e){return e||(e={}),new edges.Renderer(e)},Renderer:function(e){this.component=e.component||!1,this.init=function(e){this.component=e},this.draw=function(e){}},newComponent:function(e){return e||(e={}),new edges.Component(e)},Component:function(e){this.id=e.id,this.renderer=e.renderer,this.category=e.category||"none",this.defaultRenderer=e.defaultRenderer||"newRenderer",this.init=function(e){this.edge=e,this.context=this.edge.jq("#"+this.id),this.renderer||(this.renderer=this.edge.getRenderPackObject(this.defaultRenderer)),this.renderer&&this.renderer.init(this)},this.draw=function(){this.renderer&&this.renderer.draw()},this.contrib=function(e){},this.synchronise=function(){},this.jq=function(e){return this.edge.jq(e)}},newSelector:function(e){return e||(e={}),edges.Selector.prototype=edges.newComponent(e),new edges.Selector(e)},Selector:function(e){this.field=e.field,this.display=e.display||this.field,this.active=e.active||!0,this.disabled=e.disabled||!1,this.category=e.category||"selector"},newTemplate:function(e){return e||(e={}),new edges.Template(e)},Template:function(e){this.draw=function(e){}},instantiate:function(e,t,r){t||(t={}),r&&(e.prototype=r(t));var s=new e(t);return r&&(s.__proto_constructor__=r),s},up:function(e,t,r){var s=new e.__proto_constructor__;s[t].apply(e,r)},objClosure:function(e,t,r,s){return function(){if(r){for(var i={},n=0;n<r.length;n++)arguments.length>n&&(i[r[n]]=arguments[n]);s&&(i=$.extend(i,s)),e[t](i)}else{var c=Array.prototype.slice,o=c.apply(arguments);s&&o.push(s),e[t].apply(e,o)}}},eventClosure:function(e,t,r){return function(s){(!r||r(s))&&(s.preventDefault(),e[t](this))}},css_classes:function(e,t,r){var s=e+"-"+t;return r&&(s+=" "+s+"-"+r.component.id),s},css_class_selector:function(e,t,r){var s="."+e+"-"+t;return r&&(s+=s+"-"+r.component.id),s},css_id:function(e,t,r){var s=e+"-"+t;return r&&(s+="-"+r.component.id),s},css_id_selector:function(e,t,r){return"#"+edges.css_id(e,t,r)},on:function(e,t,r,s,i,n){r.component&&r.component.id?t=t+"."+r.component.id:r.namespace&&(t=t+"."+r.namespace);var c=edges.eventClosure(r,s,n);i?r.component?r.component.jq(e).bindWithDelay(t,c,i):r.edge?r.edge.jq(e).bindWithDelay(t,c,i):console.log("attempt to bindWithDelay on caller which has neither inner component or edge"):r.component?r.component.jq(e).on(t,c):r.edge?r.edge.jq(e).on(t,c):console.log("attempt to bindWithDelay on caller which has neither inner component or edge")},escapeHtml:function(e,t){if(void 0===t&&(t=""),void 0===e||null==e)return t;try{return"function"!=typeof e.replace?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}catch(r){return t}},objVal:function(e,t,r){void 0===r&&(r=!1);for(var s=e.split("."),i=t,n=0;n<s.length;n++){var c=s[n];if(!(c in i))return r;i=i[c]}return i},getParam:function(e,t){return void 0!==e?e:t},safeId:function(e){return e.replace(/&/g,"_").replace(/</g,"_").replace(/>/g,"_").replace(/"/g,"_").replace(/'/g,"_").replace(/\./gi,"_").replace(/\:/gi,"_").replace(/\s/gi,"_")},numFormat:function(e){var t=edges.getParam(e.prefix,""),r=edges.getParam(e.zeroPadding,!1),s=edges.getParam(e.decimalPlaces,!1),i=edges.getParam(e.thousandsSeparator,!1),n=edges.getParam(e.decimalSeparator,"."),c=edges.getParam(e.suffix,"");return function(e){e=parseFloat(e),e=s!==!1?e.toFixed(s):e.toString();var o=e.split(".");if(r!==!1){for(var a=r-o[0].length,u="",h=0;a>h;h++)u+="0";o[0]=u+o[0]}return i!==!1&&(o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,i)),1==o.length?t+o[0]+c:t+o[0]+n+o[1]+c}},numParse:function(e){var t=new RegExp(",","g");return function(e){return e=e.trim(),e=e.replace(t,e),parseFloat(e)}}};
$.extend(edges,{csv:{serialise:function(e){var t=e.data;return Papa.unparse(t,{newline:"\n"})},newObjectByRow:function(e){return e||(e={}),new edges.csv.ObjectByRow(e)},ObjectByRow:function(e){this.sheet=!1,this.filters=[],this.parse=function(e){var t=e.data.replace(/\r\n/g,"\n");this.sheet=Papa.parse(t,{header:!0,newline:"\n",skipEmptyLines:!0})},this.add_filter=function(e){var t=e.filter;this.filters.push(t)},this.clear_filter=function(e){for(var t=e.filter,r=!1,n=0;n<this.filters.length;n++){var i=this.filters[n],s=t.field===i.field,a=t.type===i.type||void 0===t.type,g=void 0===t.value||t.value.toString()===i.value.toString();if(s&&a&&g){r=n;break}}r!==!1&&this.filters.splice(r,1)},this.iterator=function(e){e||(e={});var t=edges.getParam(e.filtered,!0),r=0,n=this;return{next:function(){if(n.sheet.data.length<=r)return!1;for(var e=r;e<n.sheet.data.length;e++){var i=n.sheet.data[e],s=!1;if(s=t?n._filterMatch({record:i}):!0)return r=e+1,i}return!1}}},this.aggregation=function(e){var t=e.agg,r=Object.keys(t)[0],n=t[r],i=edges.getParam(e.filtered,!0);return"terms"===r?this._termsAggregation({field:n,filtered:i}):[]},this.applyAggregations=function(e){for(var t=e.aggs,r=edges.getParam(e.filtered,!0),n=[],i=0;i<t.length;i++)n.push({name:t[i].name});for(var s=this.iterator({filtered:r}),a=s.next();a;){for(var i=0;i<t.length;i++){var g=n[i];t[i].consume({doc:a,context:g})}a=s.next()}return n},this._termsAggregation=function(e){for(var t=e.field,r=edges.getParam(e.filtered,!0),n=[],i={},s=this.iterator({filtered:r}),a=s.next();a;){if(a.hasOwnProperty(t)){var g=a[t];if(g in i)n[i[g]].count++;else{var o=n.length;n.push({term:g,count:1}),i[g]=o}}a=s.next()}return n},this._filterMatch=function(e){for(var t=e.record,r=0;r<this.filters.length;r++){var n=this.filters[r];if("exact"!==n.type)return!1;if(!this._exactFilterMatch({filter:n,record:t}))return!1}return!0},this._exactFilterMatch=function(e){var t=e.filter,r=e.record,n=t.field,i=t.value;return r[n]!==i?!1:!0},this.parse(e)},newAggregation:function(e){return edges.instantiate(edges.csv.Aggregation,e)},Aggregation:function(e){this.name=e.name,this.nested=edges.getParam(e.nested,[]),this.consume=function(e){var t=this.aggregate(e);if(t!==!1&&this.nested.length>0){if(!("aggs"in t)){t.aggs=[];for(var r=0;r<this.nested.length;r++)t.aggs.push({name:this.nested[r].name})}for(var r=0;r<this.nested.length;r++){var n=t.aggs[r];this.nested[r].consume({doc:e.doc,context:n})}}},this.aggregate=function(e){}},newTermsAggregation:function(e){return edges.instantiate(edges.csv.TermsAggregation,e,edges.csv.newAggregation)},TermsAggregation:function(e){this.field=e.field,this.aggregate=function(e){var t=e.doc,r=e.context;if("posMap"in r||(r.posMap={}),"terms"in r||(r.terms=[]),t.hasOwnProperty(this.field)){var n=t[this.field];if(n in r.posMap)r.terms[r.posMap[n]].count++;else{var i=r.terms.length;r.terms.push({term:n,count:1}),r.posMap[n]=i}return r.terms[r.posMap[n]]}return!1}},newSumAggregation:function(e){return edges.instantiate(edges.csv.SumAggregation,e,edges.csv.newAggregation)},SumAggregation:function(e){this.field=e.field,this.numParse=edges.numParse(),this.aggregate=function(e){var t=e.doc,r=e.context;if("sum"in r||(r.sum=0),t.hasOwnProperty(this.field)){var n=t[this.field];r.sum+=this.numParse(n)}return!1}}}});
$.extend(edges,{newChart:function(e){return e||(e={}),edges.Chart.prototype=edges.newComponent(e),new edges.Chart(e)},Chart:function(e){this.category=e.category||"chart",this.display=e.display||"",this.dataSeries=e.dataSeries||!1,this.dataFunction=e.dataFunction||!1,this.dataFunctionClosure=e.dataFunctionClosure||!1,this.aggregations=e.aggregations||[],this.dfArgs=e.dfArgs||{useAggregations:[],seriesKeys:{}},this.defaultRenderer=e.defaultRenderer||"newMultibarRenderer",this.init=function(e){edges.newComponent().init.call(this,e);for(var t=0;t<this.aggregations.length;t++){var r=this.aggregations[t];-1===$.inArray(r.name,this.dfArgs.useAggregations)&&this.dfArgs.useAggregations.push(r.name)}this.aggregations.length>0&&this.dataFunctionClosure&&(this.dataFunction=this.dataFunctionClosure(this.dfArgs))},this.contrib=function(e){for(var t=0;t<this.aggregations.length;t++)e.addAggregation(this.aggregations[t])},this.synchronise=function(){this.dataFunction&&(this.dataSeries=this.dataFunction(this))}},ChartDataFunctions:{terms:function(e){var t=e.useAggregations||[],r=e.seriesKeys||{};return function(e){var a=[];if(!e.edge.result)return a;for(var n=0;n<t.length;n++){var s=t[n],i=e.edge.result.data.aggregations[s].buckets,u={};u.key=r[s],u.values=[];for(var l=0;l<i.length;l++){var o=i[l].doc_count,d=i[l].key;u.values.push({label:d,value:o})}a.push(u)}return a}},termsStats:function(e){var t=e.useAggregations||[],r=e.seriesKeys||{},a=e.seriesFor||[];return function(e){var n=[];if(!e.edge.result)return n;for(var s=0;s<t.length;s++)for(var i=t[s],u=i.split(" "),l=0;l<a.length;l++){var o=a[l],d={};d.key=r[i+" "+o],d.values=[];for(var g=e.edge.result.data.aggregations[u[0]].buckets,h=0;h<g.length;h++){var f=g[h][u[1]],v=g[h].key,c=f[o];d.values.push({label:v,value:c})}n.push(d)}return n}},recordsXY:function(e){var t=e.x,r=void 0===e.x_default?0:e.x_default,a=e.y,n=void 0===e.y_default?0:e.y_default,s=e.key;return function(e){var i=[];if(!e.edge.result)return i;var u={};u.key=s,u.values=[];for(var l=e.edge.result.results(),o=0;o<l.length;o++){var d=l[o],g=edges.objVal(t,d,r),h=edges.objVal(a,d,n);u.values.push({label:g,value:h})}return i.push(u),i}},cumulativeXY:function(e){var t=e.x,r=void 0===e.x_default?0:e.x_default,a=e.y,n=void 0===e.y_default?0:e.y_default,s=e.key,i=e.accumulate||"y";return function(e){var u=[];if(!e.edge.result)return u;var l={};l.key=s,l.values=[];for(var o=0,d=e.edge.result.results(),g=0;g<d.length;g++){var h=d[g],f=edges.objVal(t,h,r),v=edges.objVal(a,h,n);"x"===i?(o+=f,l.values.push({label:o,value:v})):"y"===i&&(o+=v,l.values.push({label:f,value:o}))}return u.push(l),u}},totalledList:function(e){var t=e.listPath||"",r=e.seriesKey||"",a=e.keyField||!1,n=e.valueField||!1;return function(e){var s=[];if(!e.edge.result)return s;var i={};i.key=r,i.values=[];for(var u={},l=e.edge.result.results(),o=0;o<l.length;o++)for(var d=l[o],g=edges.objVal(t,d,[]),h=0;h<g.length;h++){var f=g[h],v=edges.objVal(a,f,!1),c=edges.objVal(n,f,0);v in u?u[v]+=c:u[v]=c}for(v in u){var p=u[v];i.values.push({label:v,value:p})}return s.push(i),s}}},newPieChart:function(e){return e||(e={}),edges.PieChart.prototype=edges.newChart(e),new edges.PieChart(e)},PieChart:function(e){this.defaultRenderer=e.defaultRenderer||"newPieChartRenderer"},newHorizontalMultibar:function(e){return e||(e={}),edges.HorizontalMultibar.prototype=edges.newChart(e),new edges.HorizontalMultibar(e)},HorizontalMultibar:function(e){this.defaultRenderer=e.defaultRenderer||"newHorizontalMultibarRenderer"},newMultibar:function(e){return e||(e={}),edges.Multibar.prototype=edges.newChart(e),new edges.Multibar(e)},Multibar:function(e){this.defaultRenderer=e.defaultRenderer||"newMultibarRenderer"},newSimpleLineChart:function(e){return e||(e={}),edges.SimpleLineChart.prototype=edges.newChart(e),new edges.SimpleLineChart(e)},SimpleLineChart:function(e){this.xAxisLabel=e.xAxisLabel||"",this.yAxisLabel=e.yAxisLabel||"",this.defaultRenderer=e.defaultRenderer||"newSimpleLineChartRenderer"},newChartsTable:function(e){return e||(e={}),edges.ChartsTable.prototype=edges.newComponent(e),new edges.ChartsTable(e)},ChartsTable:function(e){this.chartComponents=edges.getParam(e.chartComponents,!1),this.tabularise=edges.getParam(e.tabularise,!1),this.defaultRenderer=e.defaultRenderer||"newChartsTableRenderer",this.results=[],this.synchronise=function(){if(this.results=[],this.chartComponents){for(var e=[],t=0;t<this.edge.components.length;t++){var r=this.edge.components[t];$.inArray(r.id,this.chartComponents)>-1&&e.push(r)}this.tabularise&&(this.results=this.tabularise(e))}}}});
$.extend(edges,{newStaticDataGrid:function(e){return e||(e={}),edges.StaticDataGrid.prototype=edges.newComponent(e),new edges.StaticDataGrid(e)},StaticDataGrid:function(e){this.resourceId=edges.getParam(e.resourceId,!1),this.results=[],this.synchronise=function(){this.results=[];for(var e=this.edge.resources[this.resourceId],t=e.iterator(),s=t.next();s;)this.results.push(s),s=t.next()}},newStaticDataSelector:function(e){return e||(e={}),edges.StaticDataSelector.prototype=edges.newComponent(e),new edges.StaticDataSelector(e)},StaticDataSelector:function(e){this.resourceId=edges.getParam(e.resourceId,!1),this.filterResourceIds=edges.getParam(e.filterResourceIds,[this.resourceId]),this.field=edges.getParam(e.field,!1),this.display=edges.getParam(e.display,"Untitled"),this.filters=[],this.selected=[],this.values=[],this.terms=[],this.synchronise=function(){this.filters=[],this.selected=[],this.values=[],this.terms=[];for(var e=this.edge.resources[this.resourceId],t=e.aggregation({agg:{terms:this.field},filtered:!1}),s=0;s<t.length;s++){var r=t[s];""!==r.term&&(this.values.push({term:r.term,display:r.term,count:r.count}),this.terms.push({term:r.term,display:r.term,count:r.count}))}for(var s=0;s<e.filters.length;s++){var i=e.filters[s],a=i.field;if(a===this.field){var c=i.value;this.filters.push({term:c,display:c}),this.selected.push(c)}}},this.selectTerm=function(e){for(var t={field:this.field,type:"exact",value:e},s=0;s<this.filterResourceIds.length;s++){var r=this.filterResourceIds[s];this.edge.resources[r].add_filter({filter:t})}this.edge.cycle()},this.removeFilter=function(e){var t=!1;t=e?{field:this.field,type:"exact",value:e}:{field:this.field};for(var s=0;s<this.filterResourceIds.length;s++){var r=this.filterResourceIds[s];this.edge.resources[r].clear_filter({filter:t})}this.edge.cycle()},this.selectTerms=function(e){var t=e.terms;return this.removeFilter(),this.selectTerm(t[0]),!0},this.changeSize=function(e){},this.changeSort=function(e,t){}}});
$.extend(edges,{nvd3:{DataSeriesConversions:{toXY:function(e){for(var t=[],a=0;a<e.length;a++){var i=e[a],s={};s.key=i.key,s.values=[];for(var n=0;n<i.values.length;n++){var r=i.values[n];s.values.push({x:r.label,y:r.value})}t.push(s)}return t}},tools:{persistingPieColour:function(e,t){e||(e=["#ea6ccb","#8fc8b0","#a9cf85","#d90d4c","#6c537e","#64d54f","#ecc7c4","#f1712b"]),t||(t={});var a=0;return function(i,s){if(i.label in t)return t[i.label];var n=e[a%(e.length-1)];return a++,t[i.label]=n,n}}},newPieChartRenderer:function(e){return e||(e={}),edges.nvd3.PieChartRenderer.prototype=edges.newRenderer(e),new edges.nvd3.PieChartRenderer(e)},PieChartRenderer:function(e){this.showLabels=edges.getParam(e.showLabels,!0),this.donut=edges.getParam(e.donut,!1),this.labelThreshold=e.labelThreshold||.05,this.transitionDuration=e.transitionDuration||500,this.noDataMessage=e.noDataMessage||!1,this.color=e.color||!1,this.legendPosition=e.legendPosition||"top",this.labelsOutside=edges.getParam(e.labelsOutside,!1),this.valueFormat=e.valueFormat||!1,this.marginTop=e.marginTop||30,this.marginRight=e.marginRight||30,this.marginBottom=e.marginBottom||30,this.marginLeft=e.marginLeft||30,this.namespace="edges-nvd3-pie",this.draw=function(){var e=edges.css_classes(this.namespace,"display",this),t="";this.component.display&&(t='<span class="'+e+'">'+this.component.display+"</span><br>");var a=edges.css_id(this.namespace,"svg",this),i=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html(t+'<svg id="'+a+'"></svg>');var s=this.component.dataSeries;s||(s=[]),s=s.length>0?s[0].values:[];var n=this;nv.addGraph(function(){var e=nv.models.pieChart().x(function(e){return e.label}).y(function(e){return e.value}).showLabels(n.showLabels).legendPosition(n.legendPosition).labelsOutside(n.labelsOutside).margin({left:n.marginLeft,right:n.marginRight,top:n.marginTop,bottom:n.marginBottom});return n.noDataMessage&&e.noData(n.noDataMessage),n.color&&e.color(n.color),n.valueFormat&&e.valueFormat(n.valueFormat),d3.select(i).datum(s).transition().duration(n.transitionDuration).call(e),e})}},newHorizontalMultibarRenderer:function(e){return e||(e={}),edges.nvd3.HorizontalMultibarRenderer.prototype=edges.newRenderer(e),new edges.nvd3.HorizontalMultibarRenderer(e)},HorizontalMultibarRenderer:function(e){this.showValues=edges.getParam(e.showValues,!0),this.toolTips=edges.getParam(e.toolTips,!0),this.controls=edges.getParam(e.controls,!1),this.stacked=edges.getParam(e.stacked,!1),this.legend=edges.getParam(e.legend,!0),this.color=e.color||!1,this.noDataMessage=edges.getParam(e.noDataMessage,!1),this.transitionDuration=e.transitionDuration||500,this.marginTop=e.marginTop||30,this.marginRight=e.marginRight||50,this.marginBottom=e.marginBottom||50,this.marginLeft=e.marginLeft||200,this.yTickFormat=edges.getParam(e.yTickFormat,",.0f"),this.xTickFormat=edges.getParam(e.xTickFormat,!1),this.valueFormat=edges.getParam(e.valueFormat,!1),this.xAxisLabel=edges.getParam(e.xAxisLabel,!1),this.yAxisLabel=edges.getParam(e.yAxisLabel,!1),this.tooltipGenerator=edges.getParam(e.tooltipGenerator,!1),this.namespace="edges-nvd3-horizontal-multibar",this.draw=function(){$(".nvtooltip").remove();var e=edges.css_id(this.namespace,"svg",this),t=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html('<svg id="'+e+'"></svg>');var a=this.component.dataSeries;a||(a=[]);var i=this;nv.addGraph(function(){var e=nv.models.multiBarHorizontalChart().x(function(e){return e.label}).y(function(e){return e.value}).margin({top:i.marginTop,right:i.marginRight,bottom:i.marginBottom,left:i.marginLeft}).showValues(i.showValues).tooltips(i.toolTips).showControls(i.controls).showLegend(i.legend);if(i.stacked&&e.multibar.stacked(i.stacked),i.yTickFormat){var s=i.yTickFormat;"string"==typeof i.yTickFormat&&(s=d3.format(i.yTickFormat)),e.yAxis.tickFormat(s)}if(i.yAxisLabel&&e.yAxis.axisLabel(i.yAxisLabel),i.xTickFormat){var s=i.xTickFormat;"string"==typeof i.xTickFormat&&(s=d3.format(i.xTickFormat)),e.xAxis.tickFormat(s)}if(i.xAxisLabel&&e.xAxis.axisLabel(i.xAxisLabel),i.valueFormat){var s=i.valueFormat;"string"==typeof i.valueFormat&&(s=d3.format(i.xTickFormat)),e.valueFormat(s)}return i.noDataMessage&&e.noData(i.noDataMessage),i.color&&e.color(i.color),i.tooltipGenerator&&e.tooltip.contentGenerator(i.tooltipGenerator),d3.select(t).datum(a).transition().duration(i.transitionDuration).call(e),nv.utils.windowResize(e.update),e})}},newMultibarRenderer:function(e){return e||(e={}),edges.nvd3.MultibarRenderer.prototype=edges.newRenderer(e),new edges.nvd3.MultibarRenderer(e)},MultibarRenderer:function(e){this.xTickFormat=e.xTickFormat||",.2f",this.yTickFormat=e.yTickFormat||",.2f",this.transitionDuration=e.transitionDuration||500,this.controls=edges.getParam(e.controls,!1),this.barColor=e.barColor||!1,this.showLegend=edges.getParam(e.showLegend,!0),this.xAxisLabel=e.xAxisLabel||"",this.yAxisLabel=e.yAxisLabel||"",this.namespace="edges-nvd3-multibar",this.draw=function(){var e=edges.css_classes(this.namespace,"display",this),t="";this.component.display&&(t='<span class="'+e+'">'+this.component.display+"</span><br>");var a=edges.css_id(this.namespace,"svg",this),i=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html(t+'<svg id="'+a+'"></svg>');var s=this.component.dataSeries;s||(s=[]),s=edges.nvd3.DataSeriesConversions.toXY(this.component.dataSeries);var n=this;nv.addGraph(function(){var e=nv.models.multiBarChart().showControls(n.controls);return e.xAxis.axisLabel(n.xAxisLabel).tickFormat(d3.format(n.xTickFormat)),e.yAxis.axisLabel(n.yAxisLabel).tickFormat(d3.format(n.yTickFormat)),n.barColor&&e.barColor(n.barColor),e.showLegend(n.showLegend),d3.select(i).datum(s).transition().duration(n.transitionDuration).call(e),nv.utils.windowResize(e.update),e})}},newSimpleLineChartRenderer:function(e){return e||(e={}),edges.nvd3.SimpleLineChartRenderer.prototype=edges.newRenderer(e),new edges.nvd3.SimpleLineChartRenderer(e)},SimpleLineChartRenderer:function(e){this.interactiveGuideline=e.interactiveGuideline||!0,this.xTickFormat=e.xTickFormat||",.2f",this.yTickFormat=e.yTickFormat||",.2f",this.transitionDuration=e.transitionDuration||500,this.lineColor=e.lineColor||!1,this.includeOnY=e.includeOnY||!1,this.showLegend=edges.getParam(e.showLegend,!0),this.xAxisLabel=e.xAxisLabel||"",this.yAxisLabel=e.yAxisLabel||"",this.namespace="edges-nvd3-simple-line-chart",this.draw=function(){var e=edges.css_classes(this.namespace,"display",this),t="";this.component.display&&(t='<span class="'+e+'">'+this.component.display+"</span><br>");var a=edges.css_id(this.namespace,"svg",this),i=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html(t+'<svg id="'+a+'"></svg>');var s=this.component.dataSeries;s||(s=[]);var n=edges.nvd3.DataSeriesConversions.toXY(s),r=this;nv.addGraph(function(){var e=nv.models.lineChart().useInteractiveGuideline(r.interactiveGuideline);return e.xAxis.axisLabel(r.xAxisLabel).tickFormat(d3.format(r.xTickFormat)),r.lineColor&&e.color(r.lineColor),r.includeOnY&&e.forceY(r.includeOnY),e.yAxis.axisLabel(r.yAxisLabel).tickFormat(d3.format(r.yTickFormat)),e.showLegend(r.showLegend),d3.select(i).datum(n).transition().duration(r.transitionDuration).call(e),nv.utils.windowResize(e.update),e})}}}});
var scoss={activeEdges:{},preSelectServiceProvider:function(e){var s=e.service_id;return function(e){var t=e.resource;t.add_filter({filter:{field:"Service ID",value:s,type:"exact"}})}},continentDF:function(e){for(var s=e.edge.resources.master_data,t=[edges.csv.newTermsAggregation({name:"continent",field:"Funder Continent",nested:[edges.csv.newSumAggregation({name:"total",field:"Funding Committed (EUR)"})]})],i=s.applyAggregations({aggs:t})[0],a={key:"By Continent",values:[]},c=0;c<i.terms.length;c++){var r=i.terms[c],d=r.term,n=r.aggs[0].sum;a.values.push({label:d,value:n})}return[a]},makeServiceProviderPage:function(e){scoss.activeEdges[e.selector]=edges.newEdge({selector:e.selector,template:scoss.newServiceProviderPageTemplate(),staticFiles:[{id:"service_registry",url:e.service_registry,processor:edges.csv.newObjectByRow,datatype:"text"},{id:"master_data",url:e.master_data,processor:edges.csv.newObjectByRow,datatype:"text",opening:scoss.preSelectServiceProvider({service_id:e.service_id})}],components:[edges.newPieChart({id:"by_continent",dataFunction:scoss.continentDF,renderer:edges.nvd3.newPieChartRenderer({valueFormat:d3.format(",d"),donut:!0,labelsOutside:!0,color:!1})})]})},newServiceProviderPageTemplate:function(e){return edges.instantiate(scoss.ServiceProviderPageTemplate,e,edges.newTemplate)},ServiceProviderPageTemplate:function(e){this.namespace="scoss-spp",this.draw=function(e){this.edge=e;var s=edges.css_classes(this.namespace,"container"),t=edges.css_classes(this.namespace,"progress"),i=edges.css_classes(this.namespace,"country"),a=edges.css_classes(this.namespace,"continent"),c=edges.css_classes(this.namespace,"top-donors"),r=edges.css_classes(this.namespace,"all-donors"),d='<div class="'+s+'"><div class="row">                    <div class="col-md-12"><div id="progress" class="'+t+'"></div></div>                    <div class="col-md-12"><div id="by_country" class="'+i+'"></div></div>                    <div class="col-md-12"><div id="by_continent" class="'+a+'"></div></div>                    <div class="col-md-12"><div id="top_donors" class="'+c+'"></div></div>                    <div class="col-md-12"><div id="all_donors" class="'+r+'"></div></div>                </div></div>';e.context.html(d)}}};
